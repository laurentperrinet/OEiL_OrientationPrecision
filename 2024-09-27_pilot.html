<!-- https://www.jspsych.org/latest/plugins/image-button-response/ -->
<!DOCTYPE html>
<html>
  <head>

    <script src="https://unpkg.com/jspsych@8.0.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-canvas-slider-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
    <link href="https://unpkg.com/jspsych@8.0.2/css/jspsych.css" rel="stylesheet" />
    <style>
      img {
        width: 1024px;
      }
            </style>
  </head>
  <body></body>
  <script>
    const timeline = [];

    /* define welcome message trial */
    // var welcome = {
    //   type: jsPsychHtmlKeyboardResponse,
    //   stimulus: "Welcome to the experiment. Press any key to begin."
    // };
    // timeline.push(welcome);

    // timeline.push({
    // type: jsPsychFullscreen,
    // fullscreen_mode: false
    // });

    function saveData(name, data){
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'write_data.php'); 
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({filedata: data}));
    }

    var jsPsych = initJsPsych({
      on_finish: function(){ 
        saveData(jsPsych.data.get().csv()); 
        //   jsPsych.data.displayData();
      }
    });

    var preload = {
      type: jsPsychPreload,
      auto_preload: true
    };
    timeline.push(preload);

    var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
          <p>In this experiment, ...
          <p>Press any key to begin.</p>
          `,
    post_trial_gap: 2000
    }; 
    timeline.push(instructions);

    // var fixation_trial = {
    //   type: jsPsychHtmlKeyboardResponse,
    //   choices: "NO_KEYS",
    //   stimulus: '+',
    //   css_classes: ['fixation']
    // };
    // timeline.push(fixation_trial);

    // https://www.jspsych.org/v8/plugins/image-keyboard-response/
    const trials = {
      type: jsPsychImageKeyboardResponse,
      prompt: '<p>Press  left or right.</p>',
      choices: ['ArrowLeft', 'ArrowRight'],
      stimulus_duration: 500,
      stimulus_height: window.screen.height,
      timeline: [
          {stimulus: 'img_pilot_folder/0.png'},
          {stimulus: 'img_pilot_folder/1.png'},
          {stimulus: 'img_pilot_folder/2.png'},
          {stimulus: 'img_pilot_folder/3.png'},
          {stimulus: 'img_pilot_folder/4.png'},
          {stimulus: 'img_pilot_folder/5.png'},
          {stimulus: 'img_pilot_folder/6.png'},
          {stimulus: 'img_pilot_folder/7.png'},
          {stimulus: 'img_pilot_folder/8.png'},
          {stimulus: 'img_pilot_folder/9.png'},
          {stimulus: 'img_pilot_folder/10.png'},
          {stimulus: 'img_pilot_folder/11.png'},
          {stimulus: 'img_pilot_folder/12.png'},
          {stimulus: 'img_pilot_folder/13.png'},
          {stimulus: 'img_pilot_folder/14.png'},
          {stimulus: 'img_pilot_folder/15.png'},
          {stimulus: 'img_pilot_folder/16.png'},
          {stimulus: 'img_pilot_folder/17.png'},
          {stimulus: 'img_pilot_folder/18.png'},
          {stimulus: 'img_pilot_folder/19.png'},
          {stimulus: 'img_pilot_folder/20.png'},
          {stimulus: 'img_pilot_folder/21.png'},
          {stimulus: 'img_pilot_folder/22.png'},
          {stimulus: 'img_pilot_folder/23.png'},
          {stimulus: 'img_pilot_folder/24.png'},
          {stimulus: 'img_pilot_folder/25.png'},
          {stimulus: 'img_pilot_folder/26.png'},
          {stimulus: 'img_pilot_folder/27.png'},
          {stimulus: 'img_pilot_folder/28.png'},
          {stimulus: 'img_pilot_folder/29.png'},
          {stimulus: 'img_pilot_folder/30.png'},
          {stimulus: 'img_pilot_folder/31.png'},
          {stimulus: 'img_pilot_folder/32.png'},
          {stimulus: 'img_pilot_folder/33.png'},
          {stimulus: 'img_pilot_folder/34.png'},
          {stimulus: 'img_pilot_folder/35.png'},
      ]
    }

    // var html = '<img src="'+trial.stimulus+'" id="jspsych-image-keyboard-response-stimulus" style="height: 100vh; width: 80vw;">'
    
    timeline.push(trials);

    // var debrief_block = {
    // type: jsPsychHtmlKeyboardResponse,
    // stimulus: function() {

    //   var trials = jsPsych.data.get().filter({task: 'response'});
    //   var correct_trials = trials.filter({correct: true});
    //   var accuracy = Math.round(correct_trials.count() / trials.count() * 100);
    //   var rt = Math.round(correct_trials.select('rt').mean());

    //   return `<p>You responded correctly on ${accuracy}% of the trials.</p>
    //     <p>Your average response time was ${rt}ms.</p>
    //     <p>Press any key to complete the experiment. Thank you!</p>`;

    // }
    // };
    // timeline.push(debrief_block);    

    jsPsych.run(timeline);
    // jsPsych.run([trial]);

    // exit fullscreen mode
    timeline.push({
      type: jsPsychFullscreen,
      fullscreen_mode: false
    });

    var data = jsPsych.data.get().filter({trial_type: 'categorize-image', correct: true});

  </script>
</html>